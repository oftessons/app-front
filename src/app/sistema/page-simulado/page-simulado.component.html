<div class="container pt-5">
  <div class="container mt-4">
    <h1 class="mt-4"> <span> | </span> Simulados</h1>
  </div>
<div class="container">
<div class="filters-container">
  <div class="select-container">
    <mat-form-field appearance="fill" class="select-questoes">
      <mat-label>Quantidade de Questões</mat-label>
      <mat-select [(value)]="quantidadeQuestoesSelecionada">
        <mat-option value="50">50 Questões</mat-option>
        <mat-option value="125">125 Questões</mat-option>
      </mat-select>
    </mat-form-field>
  </div>
  <form #filtroForm="ngForm" (ngSubmit)="filtrarQuestoes()" class="consulta-form">
    <div class="row">
      <div class="col col-12 col-md-6">
        <mat-form-field appearance="fill" class="custom-form-field">
          <mat-label>Ano</mat-label>
          <mat-select name="selectedAno" [(ngModel)]="selectedAno">
            <mat-option *ngFor="let ano of anos" [value]="ano">{{ getDescricaoAno(ano) }}</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="col col-12 col-md-6">
        <mat-form-field appearance="fill" class="custom-form-field">
          <mat-label>Dificuldade</mat-label>
          <mat-select name="selectedDificuldade" [(ngModel)]="selectedDificuldade">
            <mat-option *ngFor="let dificuldade of dificuldades" [value]="dificuldade">
              {{ getDescricaoDificuldade(dificuldade) }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>
    <div class="row">
      <div class="col col-12 col-md-6">
        <mat-form-field appearance="fill" class="custom-form-field">
          <mat-label>Tipo de Prova</mat-label>
          <mat-select name="selectedTipoDeProva" [(ngModel)]="selectedTipoDeProva">
            <mat-option *ngFor="let tipoDeProva of tiposDeProva" [value]="tipoDeProva">
              {{ getDescricaoTipoDeProva(tipoDeProva) }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="col col-12 col-md-6">
        <mat-form-field appearance="fill" class="custom-form-field">
          <mat-label>Subtema</mat-label>
          <mat-select name="selectedSubtema" [(ngModel)]="selectedSubtema">
            <mat-option *ngFor="let subtema of subtemas" [value]="subtema">
              {{ getDescricaoSubtema(subtema) }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>
    <div class="row">
      <div class="col col-12 col-md-6">
        <mat-form-field appearance="fill" class="custom-form-field">
          <mat-label>Tema</mat-label>
          <mat-select name="selectedTema" [(ngModel)]="selectedTema">
            <mat-option *ngFor="let tema of temas" [value]="tema">
              {{ getDescricaoTema(tema) }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="col col-12 col-md-6">
        <mat-form-field appearance="fill" class="palavra-chave">
          <mat-label>Pesquisar por palavra-chave</mat-label>
          <input matInput placeholder="Pesquisar por palavra-chave" name="palavraChave" [(ngModel)]="palavraChave" class="custom-input">
        </mat-form-field>        
      </div>
    </div>

    <div *ngIf="message" class="alert alert-info mt-3 alert-custom" role="alert">
      {{ message }}
    </div>

    <div class="button-row-filtro">
      <button type="submit" class="btn-filtrar">Filtrar</button>
      <button type="button" class="btn-filtrar-geral" (click)="LimparFiltro()">Limpar Filtro</button>
      <button type="button" class="btn-salvar" (click)="abrirModal()">Salvar Simulado</button>
    </div>
  </form>
</div>
</div>

<div class="modal fade" id="confirmacaoModal" #confirmacaoModalRef tabindex="-1" aria-labelledby="confirmacaoModalLabel" aria-hidden="true">
  <div class="mr-box-save-lista-overlay"></div>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="confirmacaoModalLabel">Salvar Simulado</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form class="form-group">
          <div class="mb-3">
            <label for="nomeFiltro" class="form-label">Nome <span>*</span></label>
            <input type="text" class="form-control" id="nomeFiltro" #nomeFiltroInput placeholder="Ex. Simulado de Óptica" required>
          </div>
          <div class="mb-3">
            <label for="descricaoFiltro" class="form-label">Assunto</label>
            <input type="text" class="form-control" id="descricaoFiltro" #descricaoFiltroInput placeholder="Ex. Vergência, objeto e imagem">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-success" (click)="confirmarSalvarSimulado(nomeFiltroInput.value, descricaoFiltroInput.value)">Confirmar</button>
      </div>
    </div>
  </div>
</div>


<!-- Exibição dos Resultados -->
<div *ngIf="questaoAtual">
<div class="identificadores-questao-resul">
  <h2 class="h2">Resultado da Filtragem</h2>
</div>
<div class="questao">
  <div class="identificadores-questao">
    <h3>ID: {{ questaoAtual.id }}</h3>
    <h3>Tema: {{ questaoAtual.tema }}</h3>
    <h3>Ano: {{ questaoAtual.ano }}</h3>
  </div>
  <div class="conteudo-questao">
    <div class="timer-container">
      <div class="buttons-simulado">
          <button (click)="iniciarSimulado()" class="btn-iniciar">Iniciar Simulado</button>
          <button (click)="finalizarSimulado()" class="btn-finalizar" [disabled]="!isSimuladoIniciado">Finalizar Simulado</button>
      </div>
      <div class="tempo">
        <h3>Tempo: {{ formatarTempo(tempo) }}</h3>
      </div> <!-- Temporizador centralizado -->
  </div>

    <p>{{ questaoAtual.enunciadoDaQuestao }}</p>
    <img *ngIf="questaoAtual.fotoDaQuestao" [src]="questaoAtual.fotoDaQuestao" alt="Foto da questão" class="questao-foto">
    <p>{{ questaoAtual.afirmacaoUm }}</p>
    <p>{{ questaoAtual.afirmacaoDois }}</p>
    <p>{{ questaoAtual.afirmacaoTres }}</p>
    <p>{{ questaoAtual.afirmacaoQuatro }}</p>
    <div class="row">
      <div class="col-md-12">
        <div class="form-group">
          <label>Selecione a Alternativa:</label>
          <div *ngFor="let alternativa of questaoAtual.alternativas; let i = index">
            <input 
              type="radio" 
              name="alternativa" 
              [value]="alternativa.texto"
              [(ngModel)]="selectedOption" 
              (change)="onOptionChange(alternativa.texto)"
              [checked]="alternativa.texto === selectedOption">
            {{ alternativa.texto }}
          </div>
        </div>
      </div>
    </div>
    
    <div class="button-row">
      <div class="right-buttons">
        <button class="btn-anterior" (click)="anteriorQuestao()" [disabled]="paginaAtual === 0">Anterior</button>
        <button class="btn-responder" (click)="questaoAtual && responderQuestao(questaoAtual)">Responder</button>
        <button class="btn-proxima" (click)="proximaQuestao()">Próxima</button>
      </div>
    </div>        
</div>
</div>
</div>