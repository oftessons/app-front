<div class="container pt-5">
  <div class="container mt-4">
    <div class="header">
      <h1 class="mt-4"><span> | </span> Questões</h1>
      <button class="btn-filtros" routerLink="/usuario/filtro">
        <img src="assets/imagens/q-f.svg" alt="Ícone do Filtro" class="icon">
        Filtros
      </button>
    </div>
  </div>
  <div class="container">
    <div class="filters-container">
      <form #filtroForm="ngForm" (ngSubmit)="filtrarQuestoes()" class="consulta-form">
        <div class="row">
          <div class="col col-12 col-md-6">
            <mat-form-field appearance="fill" class="custom-form-field">
              <mat-label>Ano</mat-label>
              <mat-select name="selectedAno" [(ngModel)]="selectedAno">
                <mat-option *ngFor="let ano of anos" [value]="ano">{{ getDescricaoAno(ano) }}</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <div class="col col-12 col-md-6">
            <mat-form-field appearance="fill" class="custom-form-field">
              <mat-label>Dificuldade</mat-label>
              <mat-select name="selectedDificuldade" [(ngModel)]="selectedDificuldade">
                <mat-option *ngFor="let dificuldade of dificuldades" [value]="dificuldade">
                  {{ getDescricaoDificuldade(dificuldade) }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>
        <div class="row">
          <div class="col col-12 col-md-6">
            <mat-form-field appearance="fill" class="custom-form-field">
              <mat-label>Tipo de Prova</mat-label>
              <mat-select name="selectedTipoDeProva" [(ngModel)]="selectedTipoDeProva">
                <mat-option *ngFor="let tipoDeProva of tiposDeProva" [value]="tipoDeProva">
                  {{ getDescricaoTipoDeProva(tipoDeProva) }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <div class="col col-12 col-md-6">
            <mat-form-field appearance="fill" class="custom-form-field">
              <mat-label>Subtema</mat-label>
              <mat-select name="selectedSubtema" [(ngModel)]="selectedSubtema">
                <mat-option *ngFor="let subtema of subtemas" [value]="subtema">
                  {{ getDescricaoSubtema(subtema) }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>
        <div class="row">
          <div class="col col-12 col-md-6">
            <mat-form-field appearance="fill" class="custom-form-field">
              <mat-label>Tema</mat-label>
              <mat-select name="selectedTema" [(ngModel)]="selectedTema">
                <mat-option *ngFor="let tema of temas" [value]="tema">
                  {{ getDescricaoTema(tema) }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <div class="col col-12 col-md-6">
            <mat-form-field appearance="fill" class="palavra-chave">
              <mat-label>Pesquisar por palavra-chave</mat-label>
              <input matInput placeholder="Pesquisar por palavra-chave" name="palavraChave" [(ngModel)]="palavraChave" class="custom-input">
            </mat-form-field>        
          </div>
        </div>

        <div *ngIf="message" class="alert alert-info mt-3 alert-custom" role="alert">
          {{ message }}
        </div>

        <div class="button-row-filtro">
          <button type="submit" class="btn-filtrar">Filtrar</button>
          <button type="button" class="btn-filtrar-geral" (click)="LimparFiltro()">Limpar Filtro</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Exibição dos Resultados -->
  <div *ngIf="questaoAtual">
    <div class="identificadores-questao-resul">
      <h2 class="h2">Resultado da Filtragem</h2>
    </div>
    <div class="questao">
      <div class="identificadores-questao">
        <h3>Título: {{ questaoAtual.title }}</h3>
        <h3>ID: {{ questaoAtual.id }}</h3>
        <h3>Tema: {{ questaoAtual.tema }}</h3>
        <h3>Ano: {{ questaoAtual.ano }}</h3>
      </div>
      <div class="conteudo-questao">
        <p>{{ questaoAtual.enunciadoDaQuestao }}</p>
        <img *ngIf="questaoAtual.fotoDaQuestao" [src]="questaoAtual.fotoDaQuestao" alt="Foto da questão" class="questao-foto">
        <p>{{ questaoAtual.afirmacaoUm }}</p>
        <p>{{ questaoAtual.afirmacaoDois }}</p>
        <p>{{ questaoAtual.afirmacaoTres }}</p>
        <p>{{ questaoAtual.afirmacaoQuatro }}</p>
        <div class="row">
          <div class="col-md-12">
            <div class="form-group">
              <label>Selecione a Alternativa:</label>
              <div *ngFor="let alternativa of questaoAtual.alternativas; let i = index">
                <input 
                  type="radio" 
                  name="alternativa" 
                  [value]="alternativa.texto"
                  [(ngModel)]="selectedOption" 
                  (change)="onOptionChange(alternativa.texto)"
                  [checked]="alternativa.texto === selectedOption">
                {{ alternativa.texto }}
              </div>
            </div>
          </div>
        </div>
        <div *ngIf="resposta" class="alert mt-3" [ngClass]="{'alert-success': isRespostaCorreta, 'alert-danger': !isRespostaCorreta}" role="alert">
          {{ resposta }}
        </div>
        <div *ngIf="mostrarGabarito">
          <h2 style="margin-top: 10px;">Comentário da Questão</h2>
          <img *ngIf="questaoAtual.fotoDaResposta" [src]="questaoAtual.fotoDaResposta" alt="Foto do Comentário" class="questao-foto">
          <p>{{ questaoAtual.comentarioDaQuestaoUm }}</p>
          <p>{{ questaoAtual.comentarioDaQuestaoDois }}</p>
          <p>{{ questaoAtual.comentarioDaQuestaoTres }}</p>
          <p>{{ questaoAtual.comentarioDaQuestaoQuatro }}</p>
          <p>Referência: {{ questaoAtual.referenciaBi }}</p>
          <p>Comentado por: {{ questaoAtual.comentadorDaQuestao }}</p>
          <div class="row"></div>
        </div>
        <div class="button-row">
          <div class="left-buttons">
            <button *ngIf="resposta" class="btn-gabarito" (click)="exibirGabarito()">Gabarito</button>
            <mat-form-field><mat-label>Avaliação</mat-label><mat-star-rating [(ngModel)]="avaliacao.nota"></mat-star-rating></mat-form-field><textarea [(ngModel)]="avaliacao.comentario" placeholder="Deixe um comentário"></textarea><button (click)="salvarAvaliacao()">Enviar Avaliação</button>
            <p>Média de avaliações: {{mediaAvaliacao | number:'1.1-1'}} / 5</p>
          </div>
          <div class="right-buttons">
            <button class="btn-anterior" (click)="anteriorQuestao()" [disabled]="paginaAtual === 0">Anterior</button>
            <button class="btn-responder" (click)="questaoAtual && responderQuestao(questaoAtual)">Responder</button>
            <button class="btn-proxima" (click)="proximaQuestao()">Próxima</button>
          </div>
        </div>        
    </div>
  </div>
</div>
