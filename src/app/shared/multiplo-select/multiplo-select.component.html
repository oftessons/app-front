<div class="select-container" [class.disabled]="disabled">
  <label [class.active]="multiple ? selectedValue?.length > 0 : selectedValue">{{ label }}</label>

  <div
    [ngStyle]="customStyles"
    class="select-dropdown"
    [class.disabled]="disabled"
    (click)="!disabled && toggleDropdown()"
  >
    <div *ngIf="multiple && selectedValue?.length > 0" class="selected-values">
      <span *ngFor="let value of selectedValue" class="selected-value">
        {{ getLabelFromValue(value) }}
        <span class="remove-value" *ngIf="!disabled" (click)="removeValue(value)">Ã—</span>
      </span>
    </div>

    <div *ngIf="!multiple && selectedValue" class="selected-single">
      {{ getLabelFromValue(selectedValue) }}
    </div>

    <div class="arrow-down" [class.disabled]="disabled"></div>
  </div>

  <div class="options-container" *ngIf="isOpen && !disabled">
      <input
        *ngIf="searchable" 
        type="text"
        [(ngModel)]="searchTerm"
        (input)="onSearchTermChange()"
        class="search-input"
        placeholder="Buscar..."
        (click)="$event.stopPropagation()"
    />

    <ng-container *ngIf="isGroupedOptions(); else flatOptions">
      <div class="option-group" *ngFor="let group of filteredOptions">
        <div 
          class="group-label"
          [class.premium-option]="showPremiumIcons && isGroupPremium(group)"
          (click)="onSelect(group.value)"
          [class.selected]="multiple ? selectedValue.includes(group.value) : selectedValue === group.value"
        >
          <span class="option-text">{{ group.label }}</span>
          <span 
            *ngIf="showPremiumIcons && isGroupPremium(group)" 
            class="premium-badge"
            (click)="handlePremiumClick($event, group)"
          >
            <i class="fas fa-crown"></i>
            Assine agora
          </span>
        </div>
        <div 
          class="option"
          [class.premium-option]="showPremiumIcons && isOptionPremium(opt)"
          *ngFor="let opt of group.options"
          (click)="onSelect(opt.value)"
          [class.selected]="multiple ? selectedValue.includes(opt.value) : selectedValue === opt.value"
        >
          <span class="option-text">{{ opt.label }}</span>
          <span 
            *ngIf="showPremiumIcons && isOptionPremium(opt)" 
            class="premium-badge"
            (click)="handlePremiumClick($event, opt)"
          >
            <i class="fas fa-crown"></i>
            Assine agora
          </span>
        </div>
      </div>
    </ng-container>

    <ng-template #flatOptions>
      <div 
        class="option"
        [class.premium-option]="showPremiumIcons && isOptionPremium(option)"
        *ngFor="let option of filteredOptions"
        (click)="onSelect(getOptionValue(option))"
        [class.selected]="multiple ? selectedValue.includes(getOptionValue(option)) : selectedValue === getOptionValue(option)"
      >
        <span class="option-text">{{ getOptionLabel(option) }}</span>
        <span 
          *ngIf="showPremiumIcons && isOptionPremium(option)" 
          class="premium-badge"
          (click)="handlePremiumClick($event, option)"
        >
          <i class="fas fa-crown"></i>
          Assine agora
        </span>
      </div>
    </ng-template>
  </div>
</div>