<div class="modal-overlay">
  <div class="modal-container">
    <div class="modal-header">
      <h2 class="modal-title">
        <span class="title-icon"><img src="assets/Icons/lapis.svg" alt="" srcset=""></span>
        Editar Conteúdo - Semana {{ semanaNumero }}
      </h2>
      <button class="btn-close" (click)="cancelar()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
            <path d="M18 6L6 18M6 6l12 12" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>

    <div class="modal-body">
      <!-- Informações básicas -->
      <div class="info-section">
        <div class="form-group">
          <label for="titulo">Título da Semana</label>
          <input 
            type="text" 
            id="titulo" 
            [(ngModel)]="titulo" 
            placeholder="Ex: Catarata Básica"
            class="form-input">
        </div>
      </div>

      <!-- Abas de conteúdo -->
      <div class="tabs-container">
        <div class="tabs-header">
          <button 
            class="tab-btn" 
            [class.active]="abaAtiva === 'questoes-pre'"
            (click)="trocarAba('questoes-pre')">
            <img [src]="!isDarkMode() ? 'assets/imagens/caderno.svg' : 'assets/Icons/dark/caderno-dark.svg'" alt="Questões">
            Questões Pré-Teste
          </button>
          <button 
            class="tab-btn" 
            [class.active]="abaAtiva === 'aulas'"
            (click)="trocarAba('aulas')">
            <img [src]="!isDarkMode() ? 'assets/Icons/aula.svg' : 'assets/Icons/dark/aula-dark.svg'" alt="Aulas">
            Aulas
          </button>
          <button 
            class="tab-btn" 
            [class.active]="abaAtiva === 'flashcards'"
            (click)="trocarAba('flashcards')">
            <img [src]="!isDarkMode() ? 'assets/Icons/flashcards.svg' : 'assets/Icons/dark/flashcards-dark.svg'" alt="Flashcards">
            Flashcards
          </button>
          <button 
            class="tab-btn" 
            [class.active]="abaAtiva === 'questoes-pos'"
            (click)="trocarAba('questoes-pos')">
            <img [src]="!isDarkMode() ? 'assets/imagens/caderno.svg' : 'assets/Icons/dark/caderno-dark.svg'" alt="Questões">
            Questões Pós-Teste
          </button>
        </div>

        <div class="tabs-content">
          <!-- Conteúdo: Questões Pré-Teste -->
          <div class="tab-panel" *ngIf="abaAtiva === 'questoes-pre'">
            <div class="filter-info">
              <h3>Configurar Filtros para Questões Pré-Teste</h3>
              <p class="filter-description">
                Selecione os filtros para definir quais questões aparecerão no pré-teste desta semana.
                <span class="filter-count">{{ getFiltrosAtivos('pre') }}</span>
              </p>
              <button class="btn-clear-filters" (click)="limparFiltros('pre')">
                Limpar todos os filtros
              </button>
            </div>

            <div class="filter-select number">
              <div class="form-group">
                <label for="quantidadePre">Quantidade de Questões</label>
                <input 
                  type="number" 
                  id="quantidadePre" 
                  [(ngModel)]="quantidadeQuestoesPre"
                  placeholder="Ex: 10"
                  min="1"
                  max="1000"
                  step="1"
                  class="form-input">
              </div>
            </div>
            <div class="filters-grid">

              <div class="filter-select">
                <app-multiplo-select 
                  label="Assunto" 
                  [options]="subtemasAgrupadosPorTema"
                  [(selectedValue)]="multSelectAssuntoPre" 
                  [multiple]="true"
                  [searchable]="true">
                </app-multiplo-select>
              </div>

              <div class="filter-select">
                <app-multiplo-select 
                  label="Anos" 
                  [options]="anosDescricoes"
                  [(selectedValue)]="multSelectAnosPre" 
                  [multiple]="true">
                </app-multiplo-select>
              </div>

              <div class="filter-select">
                <app-multiplo-select 
                  label="Tipo de Prova" 
                  [options]="tiposDeProvaDescricoes"
                  [(selectedValue)]="multSelectTiposProvaPre" 
                  [multiple]="true">
                </app-multiplo-select>
              </div>

              <div class="filter-select">
                <app-multiplo-select 
                  label="Dificuldade" 
                  [options]="dificuldadesDescricoes"
                  [(selectedValue)]="multSelectDificuldadesPre" 
                  [multiple]="true">
                </app-multiplo-select>
              </div>

              <div class="filter-select">
                <app-multiplo-select 
                  label="Questões" 
                  [options]="questoesCertasErradas"
                  [(selectedValue)]="multSelectQuestoesPre" 
                  [multiple]="true">
                </app-multiplo-select>
              </div>

              <div class="filter-select">
                <app-multiplo-select 
                  label="Respostas" 
                  [options]="respSimuladoDescricoes"
                  [(selectedValue)]="multSelectRespostasPre" 
                  [multiple]="true">
                </app-multiplo-select>
              </div>

              <div class="filter-select">
                <app-multiplo-select 
                  label="Comentários" 
                  [options]="questoesComentadas"
                  [(selectedValue)]="multSelectComentariosPre" 
                  [multiple]="true">
                </app-multiplo-select>
              </div>

              <div class="filter-select">
                <app-input-padrao 
                  label="Palavra-chave" 
                  [(value)]="palavraChavePre">
                </app-input-padrao>
              </div>
            </div>
          </div>

          <!-- Conteúdo: Aulas -->
          <div class="tab-panel" *ngIf="abaAtiva === 'aulas'">
            <div class="filter-info">
              <h3>Selecionar Aulas</h3>
              <p class="filter-description">
                Escolha as aulas que farão parte desta semana da trilha.
                <span class="filter-count">{{ aulasSelecionadas.length }} aula(s) selecionada(s)</span>
              </p>
              <button class="btn-clear-filters" (click)="limparSelecaoAulas()" *ngIf="aulasSelecionadas.length > 0">
                Limpar seleção
              </button>
            </div>

            <div class="form-group search-box">
              <div class="search-input-wrapper">
                <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="11" cy="11" r="8"></circle>
                  <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
                <input 
                  type="text" 
                  [value]="pesquisaAula"
                  (input)="onPesquisaChange($any($event.target).value)"
                  placeholder="Pesquisar aulas por título (mínimo 2 caracteres)..."
                  class="form-input">
                <div class="loading-spinner" *ngIf="carregandoAulas"></div>
              </div>
            </div>

            <!-- Loading state -->
            <div class="loading-state" *ngIf="carregandoAulas">
              <div class="spinner"></div>
              <p>Carregando aulas...</p>
            </div>

            <!-- Error state -->
            <div class="error-state" *ngIf="erroCarregarAulas">
              <p>{{ erroCarregarAulas }}</p>
              <button class="btn-retry" (click)="carregarAulas()">Tentar novamente</button>
            </div>

            <!-- Lista de aulas -->
            <div class="aulas-list" *ngIf="!carregandoAulas && !erroCarregarAulas">
              <div 
                *ngFor="let aula of aulasFiltradas" 
                class="aula-item-card" 
                [class.selected]="isAulaSelecionada(aula.id)"
                (click)="toggleAulaSelecionada(aula.id)">
                
                <div class="aula-checkbox">
                  <input 
                    type="checkbox" 
                    [checked]="isAulaSelecionada(aula.id)"
                    (click)="$event.stopPropagation()">
                </div>

                <div class="aula-thumbnail">
                  <img *ngIf="aula.poster" 
                       [src]="aula.poster" 
                       [alt]="aula.titulo"
                       onerror="this.style.display='none'">
                  <div class="thumbnail-placeholder" *ngIf="!aula.poster">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <polygon points="5 3 19 12 5 21 5 3"></polygon>
                    </svg>
                  </div>
                </div>

                <div class="aula-info-compact">
                  <h4 class="aula-title-compact">{{ aula.titulo }}</h4>
                  <span class="aula-category" *ngIf="aula.categoria">{{ aula.categoria }}</span>
                </div>
              </div>

              <div class="empty-state" *ngIf="aulasFiltradas.length === 0 && !carregandoAulas">
                <img src="assets/Icons/aula.svg" alt="Sem aulas" class="empty-icon">
                <p *ngIf="pesquisaAula && pesquisaAula.length >= 2">Nenhuma aula encontrada com "{{ pesquisaAula }}"</p>
                <p *ngIf="!pesquisaAula || pesquisaAula.length < 2">Digite pelo menos 2 caracteres para pesquisar ou carregue todas as aulas.</p>
                <button class="btn-retry" (click)="carregarAulas()" *ngIf="!pesquisaAula">Carregar todas as aulas</button>
              </div>
            </div>
          </div>

          <!-- Conteúdo: Flashcards -->
          <div class="tab-panel" *ngIf="abaAtiva === 'flashcards'">
            <div class="placeholder-content">
              <img src="assets/Icons/flashcards.svg" alt="Flashcards" class="placeholder-icon">
              <h3>Seleção de Flashcards</h3>
              <p>Funcionalidade em desenvolvimento. Em breve você poderá selecionar os flashcards para esta semana.</p>
            </div>
          </div>

          <!-- Conteúdo: Questões Pós-Teste -->
          <div class="tab-panel" *ngIf="abaAtiva === 'questoes-pos'">
            <div class="filter-info">
              <h3>Configurar Filtros para Questões Pós-Teste</h3>
              <p class="filter-description">
                Selecione os filtros para definir quais questões aparecerão no pós-teste desta semana.
                <span class="filter-count">{{ getFiltrosAtivos('pos') }}</span>
              </p>
              <button class="btn-clear-filters" (click)="limparFiltros('pos')">
                Limpar todos os filtros
              </button>
            </div>
            <div class="filter-select number">
              <div class="form-group">
                <label for="quantidadePos">Quantidade de Questões</label>
                <input 
                  type="number" 
                  id="quantidadePos" 
                  [(ngModel)]="quantidadeQuestoesPos"
                  placeholder="Ex: 10"
                  min="1"
                  max="1000"
                  step="1"
                  class="form-input">
              </div>
            </div>

            <div class="filters-grid">
              <div class="filter-select">
                <app-multiplo-select 
                  label="Assunto" 
                  [options]="subtemasAgrupadosPorTema"
                  [(selectedValue)]="multSelectAssuntoPos" 
                  [multiple]="true"
                  [searchable]="true">
                </app-multiplo-select>
              </div>

              <div class="filter-select">
                <app-multiplo-select 
                  label="Anos" 
                  [options]="anosDescricoes"
                  [(selectedValue)]="multSelectAnosPos" 
                  [multiple]="true">
                </app-multiplo-select>
              </div>

              <div class="filter-select">
                <app-multiplo-select 
                  label="Tipo de Prova" 
                  [options]="tiposDeProvaDescricoes"
                  [(selectedValue)]="multSelectTiposProvaPos" 
                  [multiple]="true">
                </app-multiplo-select>
              </div>

              <div class="filter-select">
                <app-multiplo-select 
                  label="Dificuldade" 
                  [options]="dificuldadesDescricoes"
                  [(selectedValue)]="multSelectDificuldadesPos" 
                  [multiple]="true">
                </app-multiplo-select>
              </div>

              <div class="filter-select">
                <app-multiplo-select 
                  label="Questões" 
                  [options]="questoesCertasErradas"
                  [(selectedValue)]="multSelectQuestoesPos" 
                  [multiple]="true">
                </app-multiplo-select>
              </div>

              <div class="filter-select">
                <app-multiplo-select 
                  label="Respostas" 
                  [options]="respSimuladoDescricoes"
                  [(selectedValue)]="multSelectRespostasPos" 
                  [multiple]="true">
                </app-multiplo-select>
              </div>

              <div class="filter-select">
                <app-multiplo-select 
                  label="Comentários" 
                  [options]="questoesComentadas"
                  [(selectedValue)]="multSelectComentariosPos" 
                  [multiple]="true">
                </app-multiplo-select>
              </div>

              <div class="filter-select">
                <app-input-padrao 
                  label="Escolha a Palavra-chave" 
                  [(value)]="palavraChavePos">
                </app-input-padrao>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-secondary" (click)="cancelar()">
        Cancelar
      </button>
      <button class="btn-primary" (click)="salvar()">
        <img src="assets/Icons/confirmar-vazio.svg" alt="Salvar">
        Salvar Alterações
      </button>
    </div>
  </div>
</div>
